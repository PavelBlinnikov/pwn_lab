# Методика проведения лабораторной работы по бинарной эксплуатации в Linux User-Mode

## Цель

Изучить базовые уязвимости бинарных приложений в Linux: уязвимость переполнения буфера на стеке (stack-based buffer overflow) и уязвимость форматной строки (format string vulnerability).

## Задачи

- Изучить базовые способы работы с библиотекой pwntools
- Изучить механизм эксплуатации уязвимости переполнения буфера
- Изучить механизм эксплуатации уязвимости форматной строки
- Изучить защитные механизмы, блокирующие эксплуатацию уязвимостей

## Первый шаг

Рассмотрим следующий код на C:

```
#include <stdio.h>

int main(void) {
	char buf[32] = {0};

	puts("Input your string:");
	gets(buf);
}
```

Проведём компиляцию с помощью команды:

```
gcc -no-pie -fno-stack-protector vuln.c
```

В представленном выше коде присутствует [уязвимость переполнения буфера на стеке](http://phrack.org/issues/49/14.html). Дело в том, что функция gets, которая используется здесь для записи строки на стек, не является безопасной для использования: она не контролирует границы записи, из-за этого возникает возможность произвести запись вне границ переменной buf.

Также важно заметить, что флаги компиляции `-no-pie` и `-fno-stack-protector` отключают защитные механизмы программы: PIE и стековую канарейку. Механизм их работы будет рассмотрен далее.

## Второй шаг

Для исследования защитных механизмов бинарных приложений нам понадобится утилита `checksec`. Установить её можно, выполнив следующие команды:
```
wget https://github.com/slimm609/checksec.sh/archive/refs/tags/2.6.0.zip
unzip 2.6.0.zip
cd checksec.sh-2.6.0
./checksec
```
Затем укажем утилите объект анализа:
```
./checksec --file=../a.out
```
Мы получим вывод такого вида:
```
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable	FILE
Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   62 Symbols	  No	0		1		../../a.out
```
Здесь мы также можем видеть, что механизмы защиты PIE и Canary отключены. Ранее мы отмечали это, рассматривая флаги компиляции, однако здесь мы можем получить такую информацию, не имея знаний об исходном коде и флагах его компиляции. 

Прочитать о таких защитных механизмах как NX и RELRO можно [здесь](https://hackmag.com/security/ctf-useless-crap/#p8)

## Третий шаг

Также для ~~проведения хакерской атаки~~ эксплуатации бинарных уязвимостей нам необходимо уметь работать с современным фреймворком pwntools, в котором есть всё нам необходимое.

Установка:
```
pip install pwntools
```

